{% extends "layout.html" %}
{% block title %}{{ campname }} Announcement Editor{% endblock %}
{% block pagename %}Announcement Editor{% endblock %}
{% block head %}
    <script>

        /* this script handles creating public events. */
        
        $(document).ready(function () {
            isClicked = false;
            //run when user clicks the submit button
            $("#submit_button").click(function () {
                if (!isClicked) {
                    isClicked = true;
                    console.log('Submit button pressed');
                    request = {};
                    request.content = $("#announcement_text").val();
                    console.log('Pushing the event to the server for processing:');
                    console.log(request);
                    $.ajax({
                        //make a POST AJAX query to the same web page as the user is currently visiting
                        url: (window.location.href),
                        type: 'POST',
                        contentType: 'application/json;charset=UTF-8',
                        data: JSON.stringify(request, null),
                        success: function (data) {
                            //upon success, the server will return a message and a URL. give the user the message and send them to the URL.
                            console.log(data);
                            if (data.message != 'none') {
                                alert(data.message);
                                isClicked = false;
                            }
                            if (data.url != 'none') {
                                window.location = data.url;
                            }
                            else {
                                isClicked = false;
                            }
                        }
                    });
                }
            });
        });
    </script>
{% endblock %}
{% block tools %}
<h4><b>Tools</b></h4>
<a href="#" class="w3-hover-black " id="submit_button">Submit</a>
{% endblock %}
{% block content %}
    <p>
        This page is used to edit the announcement that shows up on all user dashboards.
    </p>
    <p><textarea id="announcement_text" cols="40" rows="5">{{ currentannouncement.content }}</textarea></p>
{% endblock %}
{% block footer %}
<!-- Navbar -->
<div class="w3-bottom">
    <ul class="w3-navbar w3-theme w3-bottom w3-left-align w3-large">
        <li><a href="#" class="w3-hover-white" id="submit_button">Submit</a></li>
    </ul>
</div>
{% endblock %}