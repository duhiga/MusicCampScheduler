{% extends "layout.html" %}
{% block title %}{{ campname }} Public Event Creation{% endblock %}
{% block pagename %}Create Public Event{% endblock %}
{% block head %}
    <script>

        /* this script handles creating public events. */
        
        $(document).ready(function () {
            var isClicked = false;
            //run when user clicks the submit button
            $("#submit_button").click(function () {
                if (!isClicked) {
                    isClicked = true;
                    console.log('Submit button pressed');
                    if ($("#name_textbox").val() == "") {
                        alert('The event name cannot be empty.');
                        isClicked = false;
                        return false;
                    }
                    else {
                        request = {};
                        request.name = $("#name_textbox").val();
                        request.location = $("#location_dropdown").val();

                        console.log('Pushing the event to the server for processing:');
                        console.log(request);
                        $.ajax({
                            //make a POST AJAX query to the same web page as the user is currently visiting
                            url: (window.location.href),
                            type: 'POST',
                            contentType: 'application/json;charset=UTF-8',
                            data: JSON.stringify(request, null),
                            success: function (data) {
                                //upon success, the server will return a message and a URL. give the user the message and send them to the URL.
                                console.log(data);
                                if (data.message != 'none') {
                                    alert(data.message);
                                    isClicked = false;
                                }
                                if (data.url != 'none') {
                                    window.location = data.url;
                                }
                                else {
                                    isClicked = false;
                                }
                            }
                        });
                    }
                }
            });
        });
    </script>
{% endblock %}
{% block edit %}
<h4><b>Edit</b></h4>
<a href="#" class="w3-hover-black " id="submit_button">Submit</a>
{% endblock %}
{% block content %}
<table id="configTable">
    <tr>
        <th>Period Name</th>
        <td>{{ thisperiod.periodname }}</td>
    </tr>
    <tr>
        <th>Date</th>
        <td>{{ thisperiod.starttime.strftime('%A, %Y-%m-%d') }}</td>
    </tr>
    <tr>
        <th>Time</th>
        <td>{{ thisperiod.starttime.strftime('%H:%M') }} - {{ thisperiod.endtime.strftime('%H:%M') }}</td>
    </tr>
</table>
<p>
    This page is used to create a public event, such as a Quiz night, Drinks, Dance, etc. It appears on everyone's dashboards
    unless they are assigned to another group. Any specific group assignment overwrites this public invitation.
</p>
<p>What is the name of the event? This will appear on all user's dashboards. <input type="text" id="name_textbox"></p>
<p>
    Where will this event be held? 
    <select id="location_dropdown">
        <option value=""></option>
        {% for l in locations %}
        <option value="{{ l.locationid }}">{{ l.locationname }}</option>
        {% endfor %}
    </select>
{% endblock %}
{% block footer %}
<!-- Navbar -->
<div class="w3-bottom">
    <ul class="w3-navbar w3-theme w3-bottom w3-left-align w3-large">
        <li><a href="#" class="w3-hover-white" id="submit_button">Submit</a></li>
    </ul>
</div>
{% endblock %}