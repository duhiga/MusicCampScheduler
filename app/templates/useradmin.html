{% extends "layout.html" %}
{% block title %}{{ campname }} User Admin{% endblock %}
{% block pagename %}User Administration{% endblock %}
{% block head %}
    <script>

        //function to be used by the submit button. called by the template.
        function buildrequest() {
            var request = {}
            request.users = []
            $('.checkbox:checkbox:checked').each(function () {
                console.log('Processing email for box checked: ' + $(this).attr('id'));
                var user = {};
                user.userid = $(this).attr('id');
                request.users.push(user);
            });
            return request;
        }

        $(document).ready(function () {

            //select all checkboxes
            $("#select_all").change(function () {  //"select all" change 
                $(".checkbox").prop('checked', $(this).prop("checked")); //change all ".checkbox" checked status
            });

            //".checkbox" change
            $('.checkbox').change(function () {
                //uncheck "select all", if one of the listed checkbox item is unchecked
                if (false == $(this).prop("checked")) { //if this item is unchecked
                    $("#select_all").prop('checked', false); //change "select all" checked status to false
                }
                //check "select all" if all checkbox items are checked
                if ($('.checkbox:checked').length == $('.checkbox').length) {
                    $("#select_all").prop('checked', true);
                }
            });
        });

    </script>
{% endblock %}
{% block tools %}
<h4><b>Tools</b></h4>
<a href="/user/{{ thisuser.userid }}/newuser/" class="w3-hover-black">New User</a>
<a href="#" class="w3-hover-black submit_button" id="email_users" data-method="POST" data-url="/user/{{ thisuser.userid }}/email/">Email Selected Users</a>
{% endblock %}
{% block content %}
    <a href="/user/{{ thisuser.userid }}/newuser/">Create a New User</a>
    <table style="width:100%" class="sortable-table">
        <thead>
            <tr>
                <td><input type="checkbox" id="select_all"></td>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Active</th>
                <th>Playcount</th>
                <th>User Home</th>
            </tr>
        </thead>
        <tbody class="zebra-table">
            {% if users != None %}
            {% for u in users %}
            <tr>
                <td><input type="checkbox" id="{{ u.userid }}" class="checkbox"></td>
                <td><a href="/user/{{ thisuser.userid }}/edituser/{{ u.userid }}/">{{ u.firstname }}</a></td>
                <td><a href="/user/{{ thisuser.userid }}/edituser/{{ u.userid }}/">{{ u.lastname }}</a></td>
                <td>{% if u.isactive == 1 %}Yes{% else %}No{% endif %}</td>
                <td>{{ u.playcount }}</td>
                <td><a href="/user/{{ u.userid }}/">User Home</a></td>
            </tr>
            {% endfor %}
            {% endif %}
        </tbody>
    </table>
{% endblock %}
{% block footer %}{% endblock %}